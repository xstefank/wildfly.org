<!DOCTYPE html>
<html>

<head>
  <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>What's new for WildFly 27 in the cloud.</title>
  <meta name="description" content="">
  <link rel="me" href="https://fosstodon.org/@wildflyas" />
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-40221748-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-40221748-1');
  </script>


</head>

<body class="What's new for WildFly 27 in the cloud.">
  <div class="content">
    <div class="header navigation">
  <div class="logo-wrapper">
    <a href="/"><img class="wf-logo" src="/assets/img/wildfly_icons_one-color-logo.png"></a>
  </div>
  <div class="nav-container">
    <nav>
      <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
      <ul class="nav-list">
        <li>
          <a href="/" class="">Home</a>
        </li>
        <li>
          <a href="/downloads/" class="">Downloads</a>
        </li>
        <li>
          <a href="/news/" class="active">News</a>
        </li>
        <li>
          <a href="/about/" class="">About</a>
        </li>
        <li>
          <a href="/contribute/" class="">Contribute</a>
        </li>
        <li>
            <a target="_blank" href="https://docs.wildfly.org">Docs</a>
        </li>
        <li>
          <a class="button-cta secondary" href="https://github.com/wildfly/wildfly/fork" target="_blank">Fork</a>
        </li>
      </ul>
    </nav>
  </div>
</div>

    <div class="post-page grid-wrapper">
  <div class="grid__item width-10-12">
    <h1 class="title">What's new for WildFly 27 in the cloud.</h1>
    
    <p class="byline">By Jean-Fran√ßois Denise | November 09, 2022</p>
  </div>
  <div class="grid__item width-10-12 doc-content">
    <div class="sect1">
<h2 id="wildfly-s2i-source-to-image-images">WildFly S2I (Source To Image) images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In April we announced the new WildFly architecture for the cloud. I strongly
encourage you to read <a href="https://www.wildfly.org/news/2022/04/20/WildFly-s2i-v2-Released/">that post</a> to get familiar with this new architecture.</p>
</div>
<div class="paragraph">
<p>We have discontinued the release of WildFly s2i centos7 based images starting WildFly 26.1.2.
For new features and bug fixes, we are now only releasing UBI8 based JDK11/JDK17 s2i builder and runtime images along with
the Galleon <a href="https://github.com/wildfly-extras/wildfly-cloud-galleon-pack">wildfly-cloud-galleon-pack</a>.</p>
</div>
<div class="paragraph">
<p>The latest artifacts that form the WildFly cloud experience are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WildFly Source-to-Image (S2I) builder images (<a href="https://quay.io/repository/wildfly/wildfly-s2i-jdk11">JDK11</a> and <a href="https://quay.io/repository/wildfly/wildfly-s2i-jdk17">JDK17</a>)</p>
</li>
<li>
<p>WildFly runtime images (<a href="https://quay.io/repository/wildfly/wildfly-runtime-jdk11">JDK11</a> and <a href="https://quay.io/repository/wildfly/wildfly-runtime-jdk17">JDK17</a>)</p>
</li>
<li>
<p><a href="https://github.com/wildfly/wildfly-maven-plugin/">WildFly Maven plugin 4.0.0.Final</a></p>
</li>
<li>
<p><a href="https://github.com/wildfly-extras/wildfly-cloud-galleon-pack">WildFly cloud Galleon feature-pack 2.0.0.Final</a></p>
</li>
<li>
<p><a href="https://github.com/wildfly-extras/wildfly-datasources-galleon-pack">WildFly datasources Galleon feature-pack 3.0.0.Final</a></p>
</li>
<li>
<p><a href="https://github.com/wildfly/wildfly-charts">Helm Chart for WildFly 2.x</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="new-features-overview">New features overview</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Generation of an efficient WildFly s2i builder image. This feature, covered in detail in this blog post, is specified in this <a href="https://github.com/wildfly/wildfly-s2i/issues/393">enhancement description</a>.
The environment variables that allow you to configure an S2I build to produce a WildFly S2I builder for a given WildFly server
can be found <a href="https://github.com/wildfly/wildfly-cekit-modules/blob/main/jboss/container/wildfly/s2i/2.0/legacy/module.yaml">here</a>.</p>
</li>
<li>
<p><code>cloud-server</code> and <code>postgresql-server</code> WildFly s2i builders. The Maven projects <a href="https://github.com/wildfly/wildfly-s2i/tree/main/wildfly-builders/cloud-server">cloud-server</a> and <a href="https://github.com/wildfly/wildfly-s2i/tree/main/wildfly-builders/postgresql-server">postgresql-server</a>
define s2i builders maven projects and Helm chart for WildFly yaml files that you can re-use to build s2i builders. Such builders will then be usable
to build your application images in an efficient way. This <a href="https://github.com/wildfly/wildfly-s2i/tree/main/examples/optimized-builder">example</a> highlights the usage of the generated builders.</p>
</li>
<li>
<p>Support for automatically discovering and registering the deployments to be secured with OIDC. This support complies with this <a href="https://github.com/wildfly/wildfly-proposals/pull/434">WildFly proposal</a>.
This support is based on the <code>elytron-oidc-client</code> subsystem. It is equivalent to the Keycloak OIDC support provided in the legacy images.
The environment variables that allow you to configure the server can be found <a href="https://github.com/wildfly/wildfly-cekit-modules/blob/main/jboss/container/wildfly/launch/oidc/module.yaml">here</a>.</p>
</li>
<li>
<p>Overriding of simple server configuration attributes using environment variables. This feature, enabled by default in the WildFly s2i images, is specified by this <a href="https://github.com/wildfly/wildfly-proposals/blob/main/management/WFCORE-5489_override_attribute_value_from_env_var.adoc#wfcore-5489---as-a-developer-i-want-to-override-management-attribute-values-using-environment-variables">proposal</a>.
WildFly on the cloud relies on container environment variables to customize its configuration for the container platform.
It is difficult to change the value of a management attribute from the standalone configuration if the attribute does not provide a default value with an expression
that can be resolved at runtime. This feature introduces a generic mechanism to let user override any <em>simple</em> management attribute
using environment variables. Complex attributes (of type <code>OBJECT</code>, <code>LIST</code>, <code>PROPERTY</code>) are not impacted by this change.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, the user could set an env var when starting WildFly to change the value of a <code>proxy-address-forwarding</code> attribute with
the env var <code>SUBSYSTEM_UNDERTOW_SERVER_DEFAULT_SERVER_HTTP_LISTENER_DEFAULT__PROXY_ADDRESS_FORWARDING</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Image streams that you can import in OpenShift and use with helm Charts:</p>
<div class="ulist">
<ul>
<li>
<p>WildFly s2i builder, JDK11 <a href="https://raw.githubusercontent.com/wildfly/wildfly-s2i/main/imagestreams/wildfly-s2i-jdk11.yaml">imagestream</a></p>
</li>
<li>
<p>WildFly s2i builder, JDK17 <a href="https://raw.githubusercontent.com/wildfly/wildfly-s2i/main/imagestreams/wildfly-s2i-jdk17.yaml">imagestream</a></p>
</li>
<li>
<p>WildFly runtime, JDK11 <a href="https://raw.githubusercontent.com/wildfly/wildfly-s2i/main/imagestreams/wildfly-runtime-jdk11.yaml">imagestream</a></p>
</li>
<li>
<p>WildFly runtime, JDK17 <a href="https://raw.githubusercontent.com/wildfly/wildfly-s2i/main/imagestreams/wildfly-runtime-jdk17.yaml">imagestream</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="wildfly-s2i-builder-generation">WildFly S2I builder generation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the main areas feedback we got for this new architecture is that an s2i build takes more time compared to legacy WildFly s2i images.
That is due to the maven resolution of the WildFly server artifacts (JBoss Modules modules jar retrieved from remote maven repositories) during provisioning.
Although <code>incremental-build</code> (re-use of the maven cache from previous build) is enabled by default when using the Helm chart for WildFly, when building multiple
applications <code>incremental build</code> is not an answer, as the maven local cache can&#8217;t be shared among different build configs.</p>
</div>
<div class="paragraph">
<p>In order to provide an answer to this issue, we have made the WildFly s2i builder image able to generate an S2i builder image for a given trimmed server.
Such a builder contains an installed WildFly server in <code>$JBOSS_HOME</code> (<code>/opt/server</code>) in which a  deployment built during the next s2i phase is deployed.
This kind of builder offers an efficient build phase, as no more provisioning is performed when building the application.</p>
</div>
<div class="paragraph">
<p>The builder image size is also reduced compared to the legacy WildFly s2i builder image. The image contains only the needed trimmed server artifacts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
An interesting aspect of generated builders is that they can be shared across the s2i builds of different application deployments that require the same server capabilities.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following diagrams covers the three S2I workflows.</p>
</div>
<div class="sect2">
<h3 id="legacy-s2i-workflow">Legacy S2I workflow</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/img/news/s2iv2/S2I_Legacy_Workflow.jpg" alt="legacy S2I">
</div>
</div>
</div>
<div class="sect2">
<h3 id="new-wildfly-s2i-workflow">New WildFly S2I workflow</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/img/news/s2iv2/New_S2I_workflow.jpg" alt="new S2I">
</div>
</div>
</div>
<div class="sect2">
<h3 id="2-phases-s2i-build-workflow-based-on-generated-builder">2 phases S2I build workflow based on generated builder</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/img/news/s2iv2/Generated_Builder_S2I_workflow.jpg" alt="generated builder">
</div>
</div>
<div class="paragraph">
<p>When building such a WildFly s2i builder, the Maven and s2i environment variables that you would need to use (e.g. to configure maven repositories, set maven args, etc)
need to be isolated in order not to collide with the same environment variables one could set when using the generated builder.
For this isolation, you need to suffix any env variable with <code>_WILDFLY_SERVER_BUILDER</code> (for example <code>MAVEN_ARGS_APPEND_WILDFLY_SERVER_BUILDER</code>).
The suffix is automatically removed during the build and the proper environment variable is exported.</p>
</div>
<div class="paragraph">
<p>A WildFly s2i builder is built from sources (actually just a pom.xml file) located inside a maven project. The WildFly Maven Plugin is used to provision the server, configured
with the Galleon layers of your choice (e.g. <code>jaxrs-server</code>, <code>cloud-server+ejb</code>, etc). The Galleon layers you can use are not limited to the WildFly Galleon layers.
You can use different Galleon feature-packs to build-up your server.
This <a href="https://github.com/wildfly/wildfly-s2i/blob/main/wildfly-builders/postgresql-server/pom.xml">pom.xml</a> file contains the provisioning of a cloud-server plus a postgresql driver and datasource
that the <a href="https://github.com/wildfly-extras/wildfly-datasources-galleon-pack">wildfly-datasources-galleon-pack</a> defines.</p>
</div>
<div class="paragraph">
<p>To make WildFly s2i builder generation possible using the Helm chart for WildFly, we have evolved it with support for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ability to disable the chained build that produces an application image. That is done thanks to the new <code>build.s2i.buildApplicationImage</code> property.
When set to <code>false</code>, the name of the generated image is the name of the chart. For example <code>helm install cloud-server-builder -f helm.yaml wildfly/wildfly</code>
will produce an Openshift imagestream named <code>cloud-server-builder</code>. The suffix <code>-build-artifacts</code> that is appended when the chained build is enabled is not added.
The generated imagestream is what will then be used when building your application using the generated builder.</p>
</li>
<li>
<p>Ability to set a different kind of image for the s2i builder image and the runtime image. By default the WildFly s2i docker images are used for s2i build
and chained build. In the context of a generated builder, the builder is of type imagestream (<code>ImageStreamTag</code> or <code>ImageStreamImage</code>).
You can set the builder type using the <code>build.s2i.builderKind</code> property.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This <a href="https://github.com/wildfly/wildfly-s2i/blob/main/wildfly-builders/cloud-server/helm.yaml">helm chart</a> file
shows how to configure an s2i build to produce a WildFly s2i builder.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="new-examples">New Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WildFly 27 supports only Jakarta EE 10, so the <a href="https://github.com/wildfly/wildfly-s2i/tree/main/examples">WildFly s2i examples</a>
have been migrated to jakarta EE 10.</p>
</div>
<div class="paragraph">
<p>In addition to the set of examples that we introduced for WildFLy 26, new examples have been included:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Automatic discovery and registration of deployments secured with keycloak OIDC protocol <a href="https://github.com/wildfly/wildfly-s2i/tree/main/examples/elytron-oidc-client-auto-reg">example</a>.</p>
</li>
<li>
<p>A JMS broker, message provider and consumer <a href="https://github.com/wildfly/wildfly-s2i/tree/main/examples/jms-broker">example</a> that relies on the new <code>embedded-activemq</code> Galleon layer that WildFly provides.</p>
</li>
<li>
<p>An <a href="https://github.com/wildfly/wildfly-s2i/tree/main/examples/postgresql-multiple-datasources">example</a> to provision a postgresql driver and
multiple datasources.</p>
</li>
<li>
<p>An <a href="https://github.com/wildfly/wildfly-s2i/tree/main/examples/optimized-builder">example</a> that highlights the new "WildFly s2i builder" generation features.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enjoy">Enjoy!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We hope that you will have an interest in these new features.
As usual we need your feedback to evolve WildFly on the cloud in the right direction. Feel free to log these as new
<a href="https://github.com/wildfly/wildfly-s2i/issues">project issues</a>.</p>
</div>
<div class="paragraph">
<p>Thank-you!</p>
</div>
<div class="paragraph">
<p>JF Denise</p>
</div>
</div>
</div>
  </div>
</div>



  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img class="wf-logo" src="/assets/img/wildfly_icons_one-color-logo.png"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">WildFly is open. All dependencies of this project are available under the <a href='https://www.gnu.org/licenses/old-licenses/lgpl-2.1.en.html' target='_blank'>LGPL 2.1</a> or compatible license.<br/><br/>This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/wildfly/wildfly.org/fork' target='_blank'>fork it</a> and show us what you‚Äôve got.</p>

    
      <div class="width-1-12 project-links">
        <strong>Navigation</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="/downloads">Downloads</a></li>
          
            <li><a href="https://docs.wildfly.org">Docs</a></li>
          
            <li><a href="https://github.com/wildfly/wildfly">Github</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <strong>Contribute</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://issues.jboss.org/browse/WFLY">Submit a bug</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/wildfly">Join the forum</a></li>
          
            <li><a href="https://github.com/wildfly/wildfly/fork">Fork WildFly</a></li>
          
            <li><a href="https://twitter.com/WildFlyAS">Follow us</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <strong>Get Help</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://groups.google.com/forum/#!forum/wildfly">Join the forum</a></li>
          
            <li><a href="https://wildfly.zulipchat.com/">Join Zulip Chat</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <strong>Find more Red Hat Middleware Community Projects</strong>
        <ul class="footer-links">
          
            <li><a href="https://www.apiman.io/">APIMan</a></li>
          
            <li><a href="http://arquillian.org">Arquillian</a></li>
          
            <li><a href="https://github.com/ansible-middleware/wildfly">Ansible Collection for Wildfly</a></li>
          
            <li><a href="http://byteman.jboss.org/">Byteman</a></li>
          
            <li><a href="http://capedwarf.org/">CapeDwarf</a></li>
          
            <li><a href="https://github.com/alechenninger/chronicler">Chronicler</a></li>
          
            <li><a href="https://github.com/darcy-framework">Darcy</a></li>
          
            <li><a href="http://debezium.io/">Debezium</a></li>
          
            <li><a href="https://www.drools.org/">Drools</a></li>
          
            <li><a href="http://gatein.jboss.org/">GateIn</a></li>
          
            <li><a href="http://www.hawkular.org/">Hawkular</a></li>
          
            <li><a href="http://hawt.io/">Hawtio</a></li>
          
            <li><a href="http://hibernate.org/">Hibernate</a></li>
          
            <li><a href="http://www.infinispan.org/">Infinispan</a></li>
          
            <li><a href="https://developers.redhat.com/products/codeready-studio/overview">CodeReady Studio</a></li>
          
            <li><a href="http://forge.jboss.org/">JBoss Forge</a></li>
          
            <li><a href="https://github.com/jboss-logging">JBoss Logging</a></li>
          
            <li><a href="http://jbossremoting.jboss.org/">JBoss Remoting</a></li>
          
            <li><a href="https://www.jbpm.org/">jBPM</a></li>
          
            <li><a href="https://jsfunit.jboss.org/">JSFUnit</a></li>
          
            <li><a href="https://www.keycloak.org/">Keycloak</a></li>
          
            <li><a href="http://modcluster.io/">Mod Cluster</a></li>
          
            <li><a href="http://modeshape.jboss.org/">ModeShape</a></li>
          
            <li><a href="https://www.optaplanner.org/">OptaPlanner</a></li>
          
            <li><a href="https://quarkus.io/">Quarkus</a></li>
          
            <li><a href="http://resteasy.jboss.org/">RESTEasy</a></li>
          
            <li><a href="https://riftsaw.jboss.org/">Riftsaw</a></li>
          
            <li><a href="http://savara.jboss.org/">Savara</a></li>
          
            <li><a href="https://weld.cdi-spec.org/">Weld</a></li>
          
            <li><a href="http://arquillian.org/">Shrinkwrap</a></li>
          
            <li><a href="http://snowdrop.jboss.org/">Snowdrop</a></li>
          
            <li><a href="https://switchyard.jboss.org/">Switchyard</a></li>
          
            <li><a href="https://tattletale.jboss.org/">Tattletale</a></li>
          
            <li><a href="http://teiid.jboss.org/">Teiid</a></li>
          
            <li><a href="https://wildfly-security.github.io/wildfly-elytron/">WildFly Elytron</a></li>
          
            <li><a href="https://thorntail.io/">Thorntail</a></li>
          
            <li><a href="http://wise.jboss.org/">Wise</a></li>
          
            <li><a href="https://xnio.jboss.org/">XNIO</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/img/redhat_reversed.svg"></a>
    </span>
  </div>
</div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/random-color-picker.js"></script>
  <script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
  </script>
</body>

</html>
