<!DOCTYPE html>
<html>

<head>
  <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WildFly 19 S2I images have been released on quay.io</title>
  <meta name="description" content="">
  <link rel="me" href="https://fosstodon.org/@wildflyas" />
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-40221748-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-40221748-1');
  </script>


</head>

<body class="WildFly 19 S2I images have been released on quay.io">
  <div class="content">
    <div class="header navigation">
  <div class="logo-wrapper">
    <a href="/"><img class="wf-logo" src="/assets/img/wildfly_icons_one-color-logo.png"></a>
  </div>
  <div class="nav-container">
    <nav>
      <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
      <ul class="nav-list">
        <li>
          <a href="/" class="">Home</a>
        </li>
        <li>
          <a href="/downloads/" class="">Downloads</a>
        </li>
        <li>
          <a href="/news/" class="active">News</a>
        </li>
        <li>
          <a href="/about/" class="">About</a>
        </li>
        <li>
          <a href="/contribute/" class="">Contribute</a>
        </li>
        <li>
            <a target="_blank" href="https://docs.wildfly.org">Docs</a>
        </li>
        <li>
          <a class="button-cta secondary" href="https://github.com/wildfly/wildfly/fork" target="_blank">Fork</a>
        </li>
      </ul>
    </nav>
  </div>
</div>

    <div class="post-page grid-wrapper">
  <div class="grid__item width-10-12">
    <h1 class="title">WildFly 19 S2I images have been released on quay.io</h1>
    
    <p class="byline">By Jean-Fran√ßois Denise | March 20, 2020</p>
  </div>
  <div class="grid__item width-10-12 doc-content">
    <div class="sect1">
<h2 id="wildfly-19-s2i-docker-images">WildFly 19 S2I Docker images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The WildFly S2I (Source-to-Image) builder and runtime Docker images for WildFly 19 have been released on <a href="https://quay.io/organization/wildfly">quay.io/wildfly</a>.</p>
</div>
<div class="paragraph">
<p>Changes since the <a href="https://wildfly.org/news/2019/10/07/WildFly-s2i-18-released/">last release</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Optimized startup. The server starts much faster, as the CLI script applied to the server configuration is now executed during server boot.</p>
</li>
<li>
<p>Support for clustering. JGroups is now part of the default server configuration.</p>
</li>
<li>
<p>The WildFly 19 Galleon decorator layer <code>web-clustering</code> (support for Infinispan-based web session clustering) is fully usable in the openshift context.
This blog post highlights the new clustering features.</p>
</li>
<li>
<p>The default standalone.xml configuration file includes the Microprofile JWT (JSON Web Token) subsystem.</p>
</li>
<li>
<p>WildFly 19 defines three new Galleon layers for Microprofile 3.3 (<code>microprofile-fault-tolerance</code>, <code>microprofile-jwt</code> and <code>microprofile-openapi</code>) which can be referenced from the <code>GALLEON_PROVISION_LAYERS</code> env variable if you want Galleon to include those subsystems in a trimmed-down server it provisions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a complete documentation on how to use these images using S2I, OpenShift and Docker,
refer to the WildFly S2I <a href="https://github.com/wildfly/wildfly-s2i/blob/wf-19.0/README.md">README</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-the-imagestreams-and-template-to-openshift">Adding the imagestreams and template to OpenShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At some point the new images will be made available from the OpenShift catalog and image repository. But you can already use these images by adding them yourselves to your OpenShift cluster.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WildFly S2I builder image stream:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc create -n myproject -f https://raw.githubusercontent.com/wildfly/wildfly-s2i/wf-19.0/imagestreams/wildfly-centos7.json</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>WildFly runtime image stream:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc create -n myproject -f https://raw.githubusercontent.com/wildfly/wildfly-s2i/wf-19.0/imagestreams/wildfly-runtime-centos7.json</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Chained build template:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc create -n myproject -f https://raw.githubusercontent.com/wildfly/wildfly-s2i/wf-19.0/templates/wildfly-s2i-chained-build-template.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>NB: If you import the image streams into your project, be sure to set the <em>ImageStreams Namespace</em> (<code>IMAGE_STREAM_NAMESPACE</code> argument) to your project namespace in the template. <em>openshift</em> being the default namespace.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="clustering-examples">Clustering examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configure-openshift">Configure Openshift</h3>
<div class="ulist">
<ul>
<li>
<p>Allow to view all pods in the project:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Be sure to kill any WildFly application running in the <code>myproject</code> namespace. Any running application would join the cluster.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="web-session-sharing-using-the-web-clustering-galleon-layer">Web session sharing using the <code>web-clustering</code> galleon layer</h3>
<div class="sect3">
<h4 id="build-and-run-the-application">Build and run the application</h4>
<div class="paragraph">
<p>We are provisioning a web server with support for web session sharing.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Build the application image:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc new-app wildfly-s2i-chained-build-template -p APPLICATION_NAME=web-clustering \
      -p GIT_REPO=https://github.com/wildfly/wildfly-s2i \
      -p GIT_CONTEXT_DIR=examples/web-clustering \
      -p GALLEON_PROVISION_LAYERS=web-server,web-clustering \
      -p IMAGE_STREAM_NAMESPACE=myproject</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an application from the application image:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc new-app myproject/web-clustering -e KUBERNETES_NAMESPACE=myproject -e JGROUPS_CLUSTER_PASSWORD=mypassword</code></pre>
</div>
</div>
<div class="paragraph">
<p>NB: The <code>KUBERNETES_NAMESPACE</code> is required to see other pods in the project, otherwise the server attempts to retrieve pods from the 'default' namespace which is not the one our project is using.
<code>JGROUPS_CLUSTER_PASSWORD</code> is used to authenticate servers in the cluster.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Expose the service:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc expose svc/web-clustering</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Access the application route, note the user created time and session ID.</p>
</li>
<li>
<p>Scale the application to 2 pods:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc scale --replicas=2 dc web-clustering</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>List pods:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc get pods</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Kill the oldest POD (which answered the first application request):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc delete pod web-clustering-1-r4cx8 -n myproject</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Access the application again. You will notice that the displayed values are the same, meaning the web session has been shared between the 2 pods.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ejb-singleton">EJB singleton</h3>
<div class="paragraph">
<p>Another aspect of the WildFly clustering features is the support for high availabilty EJB singletons. We are here running the <code>ha-singleton-deployment</code> WildFly quickstart.
In this example we are using the default server present in the wildfly S2I builder image; we are not provisioning a server trimmed-down with Galleon. We don&#8217;t have (yet) layers
for EJB features.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Build the application image:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc new-app wildfly-s2i-chained-build-template -p APPLICATION_NAME=singleton \
      -p GIT_REPO=https://github.com/wildfly/quickstart/ \
      -p GIT_BRANCH=19.0.0.Final \
      -p GIT_CONTEXT_DIR=ha-singleton-deployment  \
      -p IMAGE_STREAM_NAMESPACE=myproject \
      --build-env=MAVEN_ARGS_APPEND=-Dcom.redhat.xpaas.repo.jbossorg</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an application from the application image:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc new-app myproject/singleton -e KUBERNETES_NAMESPACE=myproject -e JGROUPS_CLUSTER_PASSWORD=mypassword</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Scale the application to 2 pods:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc scale --replicas=2 dc singleton</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Check the server logs:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc logs -f dc/singleton</code></pre>
</div>
</div>
<div class="paragraph">
<p>One pod is elected for the timer service.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List pods:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc get pods</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Kill the oldest POD (elected one):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc delete pod singleton-1-r4cx8 -n myproject</code></pre>
</div>
</div>
<div class="paragraph">
<p>The timer service is started in the remaining pod.</p>
</div>
</div>
</div>
</div>
  </div>
</div>



  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img class="wf-logo" src="/assets/img/wildfly_icons_one-color-logo.png"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">WildFly is open. All dependencies of this project are available under the <a href='https://www.gnu.org/licenses/old-licenses/lgpl-2.1.en.html' target='_blank'>LGPL 2.1</a> or compatible license.<br/><br/>This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/wildfly/wildfly.org/fork' target='_blank'>fork it</a> and show us what you‚Äôve got.</p>

    
      <div class="width-1-12 project-links">
        <strong>Navigation</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="/downloads">Downloads</a></li>
          
            <li><a href="https://docs.wildfly.org">Docs</a></li>
          
            <li><a href="https://github.com/wildfly/wildfly">Github</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <strong>Contribute</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://issues.jboss.org/browse/WFLY">Submit a bug</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/wildfly">Join the forum</a></li>
          
            <li><a href="https://github.com/wildfly/wildfly/fork">Fork WildFly</a></li>
          
            <li><a href="https://twitter.com/WildFlyAS">Follow us</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <strong>Get Help</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://groups.google.com/forum/#!forum/wildfly">Join the forum</a></li>
          
            <li><a href="https://wildfly.zulipchat.com/">Join Zulip Chat</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <strong>Find more Red Hat Middleware Community Projects</strong>
        <ul class="footer-links">
          
            <li><a href="https://www.apiman.io/">APIMan</a></li>
          
            <li><a href="http://arquillian.org">Arquillian</a></li>
          
            <li><a href="https://github.com/ansible-middleware/wildfly">Ansible Collection for Wildfly</a></li>
          
            <li><a href="http://byteman.jboss.org/">Byteman</a></li>
          
            <li><a href="http://capedwarf.org/">CapeDwarf</a></li>
          
            <li><a href="https://github.com/alechenninger/chronicler">Chronicler</a></li>
          
            <li><a href="https://github.com/darcy-framework">Darcy</a></li>
          
            <li><a href="http://debezium.io/">Debezium</a></li>
          
            <li><a href="https://www.drools.org/">Drools</a></li>
          
            <li><a href="http://gatein.jboss.org/">GateIn</a></li>
          
            <li><a href="http://www.hawkular.org/">Hawkular</a></li>
          
            <li><a href="http://hawt.io/">Hawtio</a></li>
          
            <li><a href="http://hibernate.org/">Hibernate</a></li>
          
            <li><a href="http://www.infinispan.org/">Infinispan</a></li>
          
            <li><a href="https://developers.redhat.com/products/codeready-studio/overview">CodeReady Studio</a></li>
          
            <li><a href="http://forge.jboss.org/">JBoss Forge</a></li>
          
            <li><a href="https://github.com/jboss-logging">JBoss Logging</a></li>
          
            <li><a href="http://jbossremoting.jboss.org/">JBoss Remoting</a></li>
          
            <li><a href="https://www.jbpm.org/">jBPM</a></li>
          
            <li><a href="https://jsfunit.jboss.org/">JSFUnit</a></li>
          
            <li><a href="https://www.keycloak.org/">Keycloak</a></li>
          
            <li><a href="http://modcluster.io/">Mod Cluster</a></li>
          
            <li><a href="http://modeshape.jboss.org/">ModeShape</a></li>
          
            <li><a href="https://www.optaplanner.org/">OptaPlanner</a></li>
          
            <li><a href="https://quarkus.io/">Quarkus</a></li>
          
            <li><a href="http://resteasy.jboss.org/">RESTEasy</a></li>
          
            <li><a href="https://riftsaw.jboss.org/">Riftsaw</a></li>
          
            <li><a href="http://savara.jboss.org/">Savara</a></li>
          
            <li><a href="https://weld.cdi-spec.org/">Weld</a></li>
          
            <li><a href="http://arquillian.org/">Shrinkwrap</a></li>
          
            <li><a href="http://snowdrop.jboss.org/">Snowdrop</a></li>
          
            <li><a href="https://switchyard.jboss.org/">Switchyard</a></li>
          
            <li><a href="https://tattletale.jboss.org/">Tattletale</a></li>
          
            <li><a href="http://teiid.jboss.org/">Teiid</a></li>
          
            <li><a href="https://wildfly-security.github.io/wildfly-elytron/">WildFly Elytron</a></li>
          
            <li><a href="https://thorntail.io/">Thorntail</a></li>
          
            <li><a href="http://wise.jboss.org/">Wise</a></li>
          
            <li><a href="https://xnio.jboss.org/">XNIO</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/img/redhat_reversed.svg"></a>
    </span>
  </div>
</div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/random-color-picker.js"></script>
  <script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
  </script>
</body>

</html>
